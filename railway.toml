# Railway Configuration for FitnessCRM Backend
# This configuration allows deploying the backend without manually setting Root Directory
# 
# Note: Commands include "cd backend" because this file is at the repository root.
# Railway executes commands from the root, so we navigate into backend/ first.
#
# IMPORTANT: This forces Nixpacks instead of Dockerfile
# - This file (railway.toml): Used when deploying from repository root (automatic config)
# - backend/nixpacks.toml: Used when Root Directory is manually set to "backend"

[build]
builder = "NIXPACKS"
dockerfilePath = ""
watchPatterns = ["backend/**"]

[deploy]
startCommand = "cd backend && gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120 --log-level info"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[build.nixpacksPlan]
providers = ["python"]

[build.nixpacksPlan.phases.setup]
nixPkgs = ["python311", "postgresql"]

[build.nixpacksPlan.phases.install]
cmds = ["cd backend && pip install --no-cache-dir -r requirements.txt"]

# Alternative: Set "Root Directory" to "backend" in Railway UI
# If you set Root Directory to "backend", Railway will automatically use
# the Procfile and nixpacks.toml in that directory instead of this config.
# Those files don't need "cd backend" since they're already in that directory.
